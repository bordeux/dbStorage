/*! dbStorage - v0.0.1 - 2014-07-17 */var dbStorage=dbStorage||{};!function(a){"use strict";a.error=function(){return this.initDefaultValues(),this},a.error.prototype.initDefaultValues=function(){return this.setMessage("Undefined message"),this.setCode(0),this},a.error.prototype.getMessage=function(){return this.message},a.error.prototype.getCode=function(){return this.code},a.error.prototype.setMessage=function(a){return this.message=a,this},a.error.prototype.setCode=function(a){return this.code=a,this},a.error.prototype.fromException=function(a){return"string"==typeof a?(this.setMessage(a),this):("object"==typeof a&&"string"==typeof a.message&&this.setMessage(a.message),"object"==typeof a&&"undefined"!=typeof a.code&&this.setCode(a.code),this.orginalException=a,this)}}(dbStorage);var dbStorage=dbStorage||{};!function(a){"use strict";a.field=function(a){return this.setDefaultOptions(),this.fieldName=a,this},a.field.prototype.setDefaultOptions=function(){return this.asIndex(!1),this.asPrimiary(!1),this.setType("text"),this.setAutoIcrement(!1),this.setNotNull(!1),this.setDefaultValue(null),this},a.field.prototype.getName=function(){return this.fieldName},a.field.prototype.asIndex=function(b){return this.index=a.utils.ifsetor(b,!0),this},a.field.prototype.asPrimiary=function(b){return this.primary=a.utils.ifsetor(b,!0),this},a.field.prototype.setAutoIcrement=function(b){return this.autoIcrement=a.utils.ifsetor(b,!0),this},a.field.prototype.setNotNull=function(b){return this.notNull=a.utils.ifsetor(b,!0),this},a.field.prototype.setType=function(b){if(a.fieldTypes=a.fieldTypes||{},!a.fieldTypes[b])throw(new a.error).setMessage("dbStorage::field: Field type "+b+" not found").setCode(404);return this.type=new a.fieldTypes[b],this},a.field.prototype.getType=function(){return this.type},a.field.prototype.setDefaultValue=function(a){return this.defaultValue=a,this},a.field.prototype.getDefaultValue=function(){return this.defaultValue}}(dbStorage,window);var dbStorage=dbStorage||{};!function(a){"use strict";a.open=function(b){this.dbEngine={},this.dbEngine=new a.storages.webSQL(b)},a.open.prototype.init=function(){return this.dbEngine.init()},a.open.prototype.createTable=function(a){return this.dbEngine.createTable(a)},a.open.prototype.insert=function(a,b){return this.dbEngine.insert(a,b)},a.open.select=function(){var a=Q.defer();return a.promise},a.open.delete=function(){}}(dbStorage);var dbStorage=dbStorage||{};!function(a){"use strict";a.query=function(){return this}}(dbStorage);var dbStorage=dbStorage||{};!function(a){"use strict";a.table=function(a){this.tableName=a,this.setDefaults,this.fields={}},a.table.prototype.setDefaults=function(){return this.createIfNotExsist(!1),this},a.table.prototype.addField=function(a){return this.fields[a.getName()]=a,this},a.table.prototype.getFields=function(){return this.fields},a.table.prototype.getName=function(){return this.tableName},a.table.prototype.createIfNotExsist=function(b){return this.createIfNotExsist=a.utils.ifsetor(b,!0),this}}(dbStorage,window);var dbStorage=dbStorage||{};!function(a){"use strict";a.utils={},a.utils.clone=function(a){var b=new Array;for(var c in a)b[c]="object"==typeof a[c]?this.clone(a[c]):a[c];return b},a.utils.extend=function(b,c){var b=a.utils.clone(b),c=a.utils.clone(c);for(i in c)b[i]=c[i];return clone},a.utils.ifsetor=function(a,b){return"undefined"==typeof a?b:a},a.utils.isInt=function(a){return a%1===0}}(dbStorage,window);var dbStorage=dbStorage||{};!function(a){"use strict";a.fieldTypes=a.fieldTypes||{},a.fieldTypes.text=function(){return this.type="text",this}}(dbStorage,window);var dbStorage=dbStorage||{};!function(a,b){"use strict";a.storages=a.storages||{},a.storages.webSQL=function(a){return this.dbName=a,this.dbVersion=1,this.dbSize=104857600,this},a.storages.webSQL.prototype.init=function(){var c=Q.defer();try{this.db=b.openDatabase(this.dbName,this.dbVersion,this.dbName,this.dbSize),c.resolve(this)}catch(d){c.reject((new a.error).fromException(d))}return c.promise},a.storages.webSQL.prototype.createTable=function(a){var b=(Q.defer(),a.getFields()),c=[];for(var d in b)c.push(this.__createFieldSQLDefinition(b[d]));var e=[];return e.push("CREATE TABLE"),a.createIfNotExsist&&e.push("IF NOT EXISTS"),e.push(this.escapeKey(a.getName())),e.push("("),e.push(c.join(" , ")),e.push(")"),console.log(e.join(" ")),this.query(e.join(" "))},a.storages.webSQL.prototype.__createFieldSQLDefinition=function(a){var b=[];return b.push(this.escapeKey(a.getName())),b.push(this.__convertFieldType(a)),a.notNull&&b.push("NOT NULL"),a.primary&&b.push("PRIMARY KEY"),a.autoIcrement&&b.push("AUTOINCREMENT"),b.join(" ")},a.storages.webSQL.prototype.__convertFieldType=function(a){switch(a.getType().type){case"text":return"TEXT"}return"TEXT"},a.storages.webSQL.prototype.query=function(b){var c=Q.defer();return this.db.transaction(function(a){if("object"==typeof b)for(var c in b)a.executeSql(b[c]);else a.executeSql(b)},function(b){c.reject((new a.error).fromException(b))},function(){c.resolve(arguments)}),c.promise},a.storages.webSQL.prototype.escapeKey=function(a){return["`",a,"`"].join("")},a.storages.webSQL.prototype.insert=function(b,c){var d=(Q.defer(),b.getFields()),e=[],f=[];for(var g in d){var h=d[g],i=h.getName(),j=a.utils.ifsetor(c[i],h.getDefaultValue());e.push(this.escape(j)),f.push(this.escapeKey(i))}var k=[];k.push("INSERT INTO"),k.push(this.escapeKey(b.getName())),k.push("("),k.push(f.join(" , ")),k.push(")"),k.push("VALUES ("),k.push(e.join(" , ")),k.push(")");var l=k.join(" ");return console.log(l),this.query(l)},a.storages.webSQL.prototype.escape=function(b){return null===b?"null":a.utils.isInt(b)?parseInt(b):'"'+b.replace(/(["'])/g,"'")+'"'}}(dbStorage,window);